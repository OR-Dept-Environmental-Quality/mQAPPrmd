---
author: "Ryan Michie"
date: "`r format(Sys.Date(), '%m/%d/%Y')`"
output:
  officedown::rdocx_document:
  word_document:
    reference_docx: T:/Temperature_TMDL_Revisions/model_QAPPs/R/data/Report_Template.docx
    keep_md: yes
    toc: yes
    fig_caption: yes
    fig_width: 12
    fig_height: 6
  html_document:
    toc: yes
    df_print: paged
---

---
title: "`r paste0("Modeling Quality Assurance Project Plan for the ", qapp_project_area, " Temperature Total Maximum Daily Load")`"
---

```{r, label=`setup`, include=FALSE}
options(knitr.duplicate.label = 'allow')
options(knitr.kable.NA = '')
options(tinytex.verbose = TRUE)

knitr::opts_chunk$set(results = "asis",
                      warning = FALSE,
                      error = FALSE,
                      message = FALSE,
                      autodep = TRUE)

library(knitr); library(kableExtra)
library(officedown);library(officer)
library(tidyverse)
library(captioner)
library(readxl)
library(lubridate)
library(flextable)
library(sf); library(sp)
library(rgdal)
library(ggplot2)
library(stringr);library(stringi)
library(english)
library(pacman)

tbls  <- captioner::captioner(prefix="Table")
figs <- captioner::captioner(prefix="Figure")
eqns <- captioner::captioner(prefix="Equation")

```
\newpage
**[MOVE THIS PAGE BEFORE THE TABLE OF CONTENTS] **    

This report prepared by:

Oregon Department of Environmental Quality  
700 NE Multnomah Street, Suite 600  
Portland, OR 97232  
1-800-452-4011  
www.oregon.gov/deq

Contact:  
Ryan Michie  
503-229-6162

In cooperation with:

EPA Region 10  
Tetra Tech, Inc.

Documents can be provided upon request in an alternate format for individuals with disabilities or in a language other than English for people with limited English skills. To request a document in another format or language, call DEQ in Portland at 503-229-5696, or toll-free in Oregon at 1-800-452-4011, ext. 5696; or email deqinfo@deq.state.or.us.

\newpage
**[MOVE THIS PAGE BEFORE THE TABLE OF CONTENTS] **    

**[Approval Page]**

\newpage
# Abbreviations
`r abbr`

\newpage
# Introduction

This Quality Assurance Project Plan (QAPP) summarizes the modeling approach to be used for the `r qapp_project_area` Temperature Total Maximum Daily Load (TMDL) replacement project.

A TMDL is a water quality restoration plan and the calculation of the maximum amount of a pollutant that a waterbody can receive while still meeting water quality standards for that particular pollutant. A TMDL establishes a pollutant-reduction target and allocates the maximum amount of pollutant load reductions necessary to the contributing source(s) of the pollutant. The Clean Water Act requires TMDLs be developed for waterbodies that do not meet water quality standards and are listed as water quality impaired on the State’s 303(d) list.

The `r qapp_project_area` includes several waterbodies listed on the Oregon 2018/2020 Section 303(d) Category 5 list as water quality limited for temperature. `r if(length(unique(model.info$'TMDL Document'))==1){paste0("A TMDL was previously developed for the ", qapp_project_area, " (", knitr::combine_words(strip_alpha(unique(sort(model.info$"Abbreviated Reference")))), "). This TMDL must be replaced due to recent litigation.")}else{paste0("TMDLs were previously developed for the ",qapp_project_area, " (", knitr::combine_words(strip_alpha(unique(sort(model.info$"Abbreviated Reference")))), "). These TMDLs must be replaced due to recent litigation.")}`

In 2012, The U.S. District Court found that EPA’s approval of an element of Oregon’s water quality standard for temperature, the Natural Conditions Criteria, was unlawful. The Natural Conditions Criterion stated that where the natural thermal potential of all or a portion of a waterbody exceeds the biologically-based numeric temperature criteria in OAR 340-041-0028(4), the natural thermal potential temperatures supersede the biologically-based criteria, and are deemed to be the applicable temperature criteria for that waterbody. This portion of the temperature water quality standard was effective from 2003 until EPA disapproved it in response to the court decision in 2013. Many temperature TMDLs were based on this criteria, and this became the subject of a second lawsuit brought by the Northwest Environmental Advocates against EPA asserting the EPA unlawfully approved TMDLs that were based on the now disapproved Natural Conditions Criterion. The court issued a judgment on October 4, 2019, requiring DEQ and EPA to replace 15 Oregon temperature TMDLs that were based on the Natural Conditions Criterion and to reissue the temperature TMDLs based on the remaining elements of the temperature water quality standard.

This QAPP has been developed to document the analysis and numerical modeling approach that will support the `r qapp_project_area` TMDL as well as other project details. To that end, the modeling and analysis used in the previous TMDL will form the basis of the modeling approach for the TMDL replacement. In particular, this QAPP details the following:

*	Definition of the issue and objectives, including the spatial and temporal extents of the water quality impairments (Section 2);    

*	A high-level assessment of sources of pollution (Section 3);    

*	The overarching technical approach, including the appropriate modeling and analytical tools to be used (Section 4);    

*	The data sources for defining and creating inputs to the model, including data that were used in the modeling for the original TMDL. Examples of these inputs include weather, tributary stream flow and temperature, point sources and vegetation characteristics (Sections 5 and 6);    

*	How the analysis and modeling will be evaluated for acceptability (Sections 7 and 9);    

*	Scenarios for evaluating management strategies for reducing anthropogenic heat loads (Section 10);     

*	Various aspects for managing the TMDL development project, including documentation (Section 8), the project team (Section 11), data and records management (Sections 12  and 13); and    

*	Aspects relating to this QAPP and its role in the project (Sections 14  and 15).    

# Problem definition and management objectives

```{r, label=`cat5`, echo=FALSE}

tcat5 <- pro.cat.45.tbl %>% 
  dplyr::filter(IR_categor == "Category 5") %>% 
  dplyr::group_by(AU_Name,AU_ID,Year_liste) %>% 
  dplyr::summarize(Period = toString(unique(sort(Period)))) %>% 
  dplyr::ungroup() %>% 
  dplyr::rename(Waterbody = AU_Name,
                `Assessment Unit ID` = AU_ID,
                `Year Listed` = Year_liste,
                `Criterion Period` = Period) %>% 
  dplyr::select(Waterbody,`Assessment Unit ID`,`Year Listed`,`Criterion Period`) %>% 
  dplyr::arrange(Waterbody,`Year Listed`)

if(NROW(tcat5)>0){
  
  tcat5 <- knitr::kable(tcat5, format = "pandoc", padding = 2,
                        caption = tbls(name = "tcat5",
                                       caption = paste0("Waterbodies listed for temperature impairment based on Section 303(d) Category 5 in the 2018/20 Integrated Report.")))
  
}


```

The `r paste0(pro.area.tmdls, " (", knitr::combine_words(strip_alpha(unique(sort(model.info$"Abbreviated Reference")))), ")")` `r if(length(unique(model.info$"TMDL Document"))==1){paste0(" was")}else{paste0(" were")}` developed for **[Update based on the project area: bacteria, aquatic weeds, biological criteria and temperature]**. The original temperature TMDLs were based on the Natural Conditions Criteria (NCC) identified in Oregon Administrative Rules (OAR), specifically OAR 340-041-0028(8). These criteria were invalidated by the Oregon U.S. District Court. The applicable numeric and narrative temperature criteria must be used. As required by court order, the U.S. Environmental Protection Agency (USEPA) and State of Oregon (OR) are required to revise the water temperature TMDL for the `r qapp_project_area`. In revising the TMDL, all of the allocations will be updated to target the applicable biologically-based numeric criteria (BBNC) and Human Use Allowance (HUA) water quality temperature standards. The numeric temperature criteria are based on a 7-Day Average Daily Maximum.

**[Update with specific temperature criteria based on the project area]**.

The existing temperature TMDL addresses temperature on streams with **[Update both point and nonpoint sources]** of thermal loads. 

The TMDL will provide load and waste load allocations for sources of thermal loads. **[Update if any specific info is needed for certain listings, time periods, or sources. Eg. During the spawning period, there are three impaired segments on the XX River that are downstream of a hydro-electric project. Modeling analysis are needed to complete TMDLs for these waterbodies.]**

Since the issuance of the original TMDL, the number of waterbodies that are identified as water quality limited for temperature on the Oregon's 2018/2020 Section 303(d) Category 5 list has changed since the original TMDL was developed. As part of the TMDL update, DEQ will address all current temperature listings based on the most recent integrated report list. The current listings, as they pertain to the `r qapp_project_area` QAPP project area, are summarized in `r tbls(name = "tcat5", display="cite")`.

`r if(NROW(tcat5)>0){tcat5}`

This QAPP document provides the management context and information about existing models to be used for the TMDL replacement.

# Conceptual model: key processes and variables

Anthropogenic heat sources are derived from solar radiation as increased levels of sunlight reach the stream surface and effluent discharges to surface waters. Therefore, the pollutants targeted in the existing TMDL are: 

**Anthropogenic Nonpoint Sources**: Heat from human-caused solar radiation loading increases to the stream network as a result of alterations in near stream vegetation, channel morphology, and flow modifications.

Historically, human activities have altered the stream morphology and hydrology and decreased the amount of riparian vegetation in the basin. The basin includes urban, agricultural, and forested lands. **[Update based on the project area: Additionally, hydroelectric projects and multiple points of diversion in the XX River Basin have altered stream flow levels.]** 

Low summertime flows decrease the thermal assimilative capacity of streams. Pollutant (solar radiation) loading causes larger temperature increases in stream segments where flows are reduced by human uses. 

Larger streams, such as the **[Update waterbody]** Rivers naturally experience a large solar flux because their channels are too wide for riparian vegetation to effectively shade the surface of the water. Smaller tributaries, such as **[Update waterbodies]**, are easier to shade and have smaller background solar flux values. “Background Sources” include all sources of pollution or pollutants not originating from human activities. In the context of a TMDL, background sources may also include anthropogenic sources of a pollutant that DEQ or another Oregon state agency does not have authority to regulate, such as pollutants emanating from another state, tribal lands, or sources otherwise beyond the jurisdiction of the state (OAR 340-042-0030(1)). Additionally, effective shade levels on smaller streams are more sensitive to riparian disturbances and so the differences between current condition solar flux and background solar flux can be larger.

**Anthropogenic Point Sources**: Heat from warm water discharges of human origin, such as industrial outfalls, municipal waste-water treatment plants (WWTP), and other point sources.

PacifiCorp’s hydroelectric project on the **[Update project area]** River is responsible for elevated stream temperatures between **[Update waterbody]** and the **[Update waterbody]** River tidewater boundary.

# Technical approach

## Overview

```{r,label=`chap6-model`,echo=FALSE}
# 6.1 summary table
tmdl.mod.1<- model.info %>% 
  dplyr::group_by(Model_version) %>% 
  dplyr::summarize(`Model Waterbody` = toString(unique(sort(`Model Waterbody`)))) %>% 
  dplyr::ungroup() %>% 
  dplyr::rename(`Model Version` = Model_version) %>% 
  dplyr::mutate(`Model Waterbody` = ifelse(`Model Version` == "SHADOW", "Multiple streams (see Section 6.4)", `Model Waterbody`))
```

Stream temperature TMDLs are generally scaled to a subbasin or basin scale since stream temperatures are affected by cumulative interactions between upstream and local source. For this reason the TMDL considers all surface waters that affect the temperatures of 303(d) listed waterbodies. For example, the **[Update waterbody]** is water quality limited for temperature. To address this listing in the TMDL, all major tributaries are included in the TMDL analysis and TMDL allocations are applied throughout the entire stream network.

An important step in the TMDL is to perform a source assessment which quantifies the anthropogenic contributions to stream heating. One anthropogenic contribution to solar radiation heat loading results from decreased stream surface shade. Decreased stream shade may be caused by near stream vegetation disturbance, removal, or channel morphology changes. Other anthropogenic sources of stream warming may include stream flow reductions and warm water point source effluent.

The pollutant addressed in the temperature TMDL is heat. Anthropogenic nonpoint and point sources are not permitted to heat a waterbody more than 0.3 $^\circ C$ above the applicable criteria, cumulatively at the point of maximum impact. Allocated conditions are expressed as solar heat load and solar heat flux (watts, and watts per square meter, respectively). Nonpoint source heat allocations are translated into effective shade surrogate measures. Effective shade surrogate measures provide site-specific targets for land managers. Attainment of the surrogate measures ensures compliance with the nonpoint source allocations. Point source waste load allocations are based on the applicable numeric and/or narrative criteria. Point sources are not allowed to increase stream temperatures more than 0.1 $^\circ C$ (a portion of the 0.3 $^\circ C$ human use allowance) cumulatively at the point of maximum impact.

Stream temperatures were simulated using `r if(NROW(tmdl.mod.1)>1){paste0("the computer models")} else {paste0("a computer model")}` (`r knitr::combine_words(tmdl.mod.1$'Model Version')`) for the main rivers and their larger tributaries. Simulations focus on the larger streams that contain or influence primary fish habitat. Site-specific load allocations have been developed for the streams that were simulated. Other streams are assigned generalized load allocations based on potential vegetation and effective shade.

## Model selection

The modeling framework needs for this project include:

1)	Prediction of hourly stream temperatures over a period of months and at a no greater than 500 meter longitudinal resolution.  

2)	Prediction of hourly solar radiation flux and daily effective shade at a no greater than 50 meter longitudinal resolution.  

3)	Ability to evaluate hourly stream temperature response from changes in streamside vegetation within the upstream catchment.  

4)	Ability to evaluate hourly stream temperature response from changes in water withdrawals and tributary stream flow within the upstream catchment.  

5)	Ability to evaluate hourly stream temperature response from changes in channel morphology within the upstream catchment.  

6)	Ability to evaluate hourly stream temperature response from changes in effluent temperature and flow discharge from NPDES permitted facilities.  

7)	**[Update as needed]**

For these reasons, the Heat Source stream thermodynamics model (Boyd and Kasper, 2003) was selected for stream temperature simulation. The Heat Source model was originally developed at Oregon State University as a master’s thesis where it was evaluated and approved by an academic committee (Boyd, 1996). Development of the model continued and in 1999 DEQ submitted the model equations and methodology for peer review (DEQ, 1999) and again in 2004 to the Independent Multidisciplinary Science Team (IMST, 2004) where the model was found to be scientifically sound.

The heat source model has been used in numerous stream temperature related studies including Bond et al. (2015), Diabat et al. (2013), Holzapfel et al. (2013), Justice et al. (2017), Lawrence et al. (2014), Loheide and Gorelick (2006), Woltemade and Hawkins (2016), and Wondzell et al. (2019). Heat Source has also been used in numerous Oregon TMDLs.

# Data availability and quality

## Meteorology

```{r, label=`t51`, echo=FALSE}
if(NROW(model.input[which(model.input$`Model Location Type` == "Meteorological"),])>0){
  
  t51_sp <- model.input %>% 
    dplyr::filter(`Model Location Type` %in% c("Meteorological")) %>%
    dplyr::filter(!is.na(`Data Source`) & is.na(`Interpolated Data`)) %>%
    dplyr::mutate(Station = ifelse(`Station ID` == "No Station ID" | is.na(`Station ID`),
                                   `Data Source`,
                                   paste0(`Station ID`, ", ", `Data Source`)),
                  `Station ID` = NA,
                  `Latitude/Longitude` = ifelse(is.na(Latitude), NA, paste0(round(Latitude,4), "/",round(Longitude,3))),
                  `Available Data` = Parameter,
                  Agency = NA,
                  tbl = "worksheet") %>% 
    dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Available Data`,Agency,tbl) %>%
    dplyr::group_by(`Station ID`, Station, `Latitude/Longitude`,Agency,tbl) %>% 
    dplyr::summarize(`Available Data` = toString(unique(sort(`Available Data`)))) %>% 
    dplyr::ungroup()
}

t51_ncei <- ncei.station.tbl %>% 
  dplyr::mutate(`Station` = STATION_NAME,
                `Station ID` = NCDC,
                `Latitude/Longitude` = paste0(round(lat,4), "/",round(long,3)),
                `Available Data` = NA,
                Agency = NA,
                tbl = "ncei") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Available Data`,Agency,tbl) %>% 
  dplyr::distinct(`Station ID`, .keep_all=TRUE) %>% 
  dplyr::distinct(Station, .keep_all=TRUE)

t51_raws <- raws.station.tbl %>% 
  dplyr::mutate(`Station` = siteName,
                `Station ID` = wrccID,
                `Latitude/Longitude` = paste0(round(lat,4), "/",round(long,3)),
                `Available Data` = NA,
                Agency = agency,
                tbl = "raws") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Available Data`,Agency,tbl) %>% 
  dplyr::distinct(`Station ID`, .keep_all=TRUE) %>% 
  dplyr::distinct(`Station`, .keep_all=TRUE)

t51_agrimet <- agrimet.station.tbl %>%
  dplyr::mutate(`Station` = description.x,
                `Station ID` = siteid,
                `Latitude/Longitude` = paste0(round(lat,4), "/",round(long,3)),
                `Available Data` = NA,
                Agency = NA,
                tbl = "agrimet") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Available Data`,Agency,tbl) %>% 
  dplyr::distinct(`Station ID`, .keep_all=TRUE) %>% 
  dplyr::distinct(`Station`, .keep_all=TRUE)

t51_hydromet <- hydromet.station.tbl %>% 
  dplyr::filter(Parameter %in% c("Air Temperature","Precipitation")) %>% 
  dplyr::mutate(`Station` = Station.Name,
                `Station ID` = Station.ID,
                `Latitude/Longitude` = paste0(round(as.numeric(Lat),4), "/",round(as.numeric(Long),3)),
                `Available Data` = Parameter,
                Agency = NA,
                tbl = "hydromet") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Available Data`,Agency,tbl) %>%
  dplyr::group_by(`Station ID`, Station, `Latitude/Longitude`,Agency,tbl) %>% 
  dplyr::summarize(`Available Data` = toString(unique(sort(`Available Data`)))) %>% 
  dplyr::ungroup()

t51_mw <- mw.station.tbl %>% 
  dplyr::mutate(`Station` = NAME,
                `Station ID` = STID,
                `Latitude/Longitude` = paste0(round(as.numeric(lat),4), "/",round(as.numeric(long),3)),
                `Available Data` = NA,
                Agency = NA,
                tbl = "mw") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Available Data`,Agency,tbl) %>% 
  dplyr::distinct(`Station ID`, .keep_all=TRUE) %>% 
  dplyr::distinct(`Station`, .keep_all=TRUE)

if(NROW(model.input[which(model.input$`Model Location Type` == "Meteorological"),])>0){
  t51 <- rbind(t51_sp,t51_ncei,t51_raws,t51_agrimet,t51_hydromet,t51_mw)} else {
    t51 <- rbind(t51_ncei,t51_raws,t51_agrimet,t51_hydromet,t51_mw)  
  }

t51_na <- t51 %>% dplyr::filter(is.na(`Latitude/Longitude`))
t51 <- t51[!duplicated(t51$`Latitude/Longitude`),] %>% 
  dplyr::filter(!is.na(`Latitude/Longitude`)) %>% 
  rbind(t51_na)
t51 <- t51[!duplicated(t51$`Station`),]

if(NROW(model.input[which(model.input$`Model Location Type` == "Meteorological"),])>0){
  
  t51.sp <- t51 %>% 
    dplyr::filter(tbl=="worksheet") %>% 
    dplyr::select(-c(`Station ID`,Agency,tbl)) %>% 
    dplyr::arrange(`Station`)
  
  if(NROW(t51.sp)>0){
    
    t51_sp_tbl <- knitr::kable(t51.sp, format = "pandoc", padding = 2,
                               caption = tbls(name = "t51_sp",
                                              caption = paste0("Meteorological stations and data available in DEQ files for the ", qapp_project_area, ".")))
    
  }
}

t51.ncei <- t51 %>% 
  dplyr::filter(tbl=="ncei") %>% 
  dplyr::select(-c(`Available Data`,Agency,tbl)) %>% 
  dplyr::arrange(`Station ID`)

if(NROW(t51.ncei)>0){
  
  t51_ncei_tbl <- knitr::kable(t51.ncei, format = "pandoc", padding = 2,
                               caption = tbls(name = "t51_ncdc",
                                              caption = paste0("Meteorological stations and data available in the National Climatic Data Center (NCDC) database in the ",
                                                               qapp_project_area, ".")))
}

t51.raws <- t51 %>% 
  dplyr::filter(tbl=="raws") %>% 
  dplyr::select(-c(`Available Data`,tbl)) %>% 
  dplyr::arrange(`Station ID`)

if(NROW(t51.raws)>0){
  
  t51_raws_tbl <- knitr::kable(t51.raws, format = "pandoc", padding = 2,
                               caption = tbls(name = "t51_raws",
                                              caption = paste0("Meteorological stations and data, including ", knitr::combine_words(unique(sort(tolower(raws.station.tbl$Parameter)))), ", available in the Remote Automatic Weather Station (RAWS) database in the ", qapp_project_area, ".")))
  
}

t51.agrimet <- t51 %>% 
  dplyr::filter(tbl=="agrimet") %>% 
  dplyr::select(-c(`Available Data`,Agency,tbl)) %>% 
  dplyr::arrange(`Station ID`)

if(NROW(t51.agrimet)>0){
  
  t51_agrimet_tbl <- knitr::kable(t51.agrimet, format = "pandoc", padding = 2,
                                  caption = tbls(name = "t51_agrimet",
                                                 caption = paste0("Meteorological stations and data, including air temperature, precipitation, relative humidity and wind, available in the USBR AgriMet database in the ", qapp_project_area, ".")))
  
}

t51.hydromet <- t51 %>% 
  dplyr::filter(tbl=="hydromet") %>% 
  dplyr::select(-c(`Available Data`,Agency,tbl))%>% 
  dplyr::arrange(`Station ID`)

if(NROW(t51.hydromet)>0){
  
  t51_hydromet_tbl <- knitr::kable(t51.hydromet, format = "pandoc", padding = 2,
                                   caption = tbls(name = "t51_hydromet",
                                                  caption = paste0("Meteorological stations and data available in the USBR Hydromet database in the ", qapp_project_area, ".")))
  
}

t51.mw <- t51 %>% 
  dplyr::filter(tbl=="mw") %>% 
  dplyr::select(-c(`Available Data`,Agency,tbl))%>% 
  dplyr::arrange(`Station ID`)

if(NROW(t51.mw)>0){
  
  t51_mw_tbl <- knitr::kable(t51.mw, format = "pandoc", padding = 2,
                             caption = tbls(name = "t51_mw",
                                            caption = paste0("Meteorological stations and data, including air temperature, precipitation, relative humidity, wind speed and wind direction, available in the MesoWest database in the ", qapp_project_area, ".")))
  
}

# Table NUM
if(NROW(model.input[which(model.input$`Model Location Type` == "Meteorological"),])>0){
  
  tables.met <- data.frame(tbl_name = c("t51.sp","t51.ncei","t51.raws","t51.agrimet","t51.hydromet","t51.mw"),
                           tbl_rows = c(NROW(t51.sp),NROW(t51.ncei),NROW(t51.raws),NROW(t51.agrimet),NROW(t51.hydromet),NROW(t51.mw))) %>% 
    dplyr::filter(tbl_rows != "0")
  
  t51_num <- NROW(tables.met)+1
  
} else {
  
  tables.met <- data.frame(tbl_name = c("t51.ncei","t51.raws","t51.agrimet","t51.hydromet","t51.mw"),
                           tbl_rows = c(NROW(t51.ncei),NROW(t51.raws),NROW(t51.agrimet),NROW(t51.hydromet),NROW(t51.mw))) %>% 
    dplyr::filter(tbl_rows != "0")
  
  t51_num <- NROW(tables.met)+1
  
}

```

Meteorological data, including air temperature, cloudiness, relative humidity, and wind speed, are available from the DEQ database, NOAA National Climatic Data Center (NCDC), National Interagency Fire Center (NIFC) Remote Automatic Weather Stations (RAWS), Bureau of Reclamation Cooperative Agricultural Weather Network (AgriMet) and Automated Hydrologic and Meteorological Monitoring Stations Network (Hydromet), and University of Utah MesoWest database. Table 2 through Table `r t51_num` list available meteorological data from these sources in the `r qapp_project_area`.

`r if(NROW(model.input[which(model.input$"Model Location Type" == "Meteorological"),])>0){t51_sp_tbl}`
`r if(NROW(t51.ncei)>0){t51_ncei_tbl}`
`r if(NROW(t51.raws)>0){t51_raws_tbl}`
`r if(NROW(t51.agrimet)>0){t51_agrimet_tbl}`
`r if(NROW(t51.hydromet)>0){t51_hydromet_tbl}`
`r if(NROW(t51.mw)>0){t51_mw_tbl}`

## Thermal infrared (TIR) data

```{r, label=`t52`, echo=FALSE}

t52 <- model.input %>% 
  dplyr::filter(`Station ID` == "TIR") %>% 
  dplyr::rename(`Abbreviated Reference` = `Data Source`) %>% 
  dplyr::left_join(ref, by = "Abbreviated Reference") %>% 
  dplyr::mutate(`Abbreviated Reference` = strip_alpha(`Abbreviated Reference`)) %>% 
  dplyr::mutate(Reference = paste(`Full Reference`, ifelse(is.na(`Reference Link`),"",`Reference Link`)))

waterbodies <- unique(sort(t52$`Model Waterbody`))

citations <- unique(sort(t52$`Abbreviated Reference`))

```

DEQ contracted with Watershed Sciences, Inc. to provide airborne thermal infrared (TIR) imagery of spatial temperature patterns within the `r qapp_project_area`. TIR data is used to characterize the thermal regime of the streams and habitat quality.

`r paste0("TIR data are available for ", knitr::combine_words(waterbodies), " (", knitr::combine_words(citations), ").")`

## Continuous stream temperature data

```{r, label=`t53`, echo=FALSE}

st_awqms <- station_awqms %>% 
  dplyr::rename(Station = StationDes,
                Organization = OrgID,
                Latitude = Lat_DD,
                Longitude = Long_DD) %>% 
  dplyr::select(Station,`Station ID`, Organization, Latitude, Longitude)

st_model <- station_model %>% 
  dplyr::filter(`Parameter` %in%  c("Water Temperature")) %>% 
  dplyr::filter(!is.na(`Data Source`) & is.na(`Interpolated Data`)) %>% 
  dplyr::filter(!`Station ID` == "TIR") %>% 
  dplyr::mutate(Station = ifelse(is.na(StationDes),`Model Location Name`,StationDes),
                Organization = ifelse(is.na(OrgID),`Data Source`,OrgID),
                Organization = ifelse(substr(Organization,1,18) == "Watershed Sciences",
                                      paste0(gsub(",.*$", "", Organization)," (",stringi::stri_sub(strip_alpha(Organization),-4),")"),Organization)) %>% 
  dplyr::select(Station,`Station ID`, Organization, Latitude, Longitude)

t53_1 <- rbind(st_awqms,st_model) %>% 
  dplyr::distinct(Station, .keep_all=TRUE) %>%
  dplyr::left_join(df.stations,by = c("Station ID"="MLocID")) %>% 
  dplyr::mutate(Station = stringr::str_to_title(Station)) %>% 
  dplyr::mutate_at("Station", str_replace_all, "Ordeq", "ORDEQ") %>%
  dplyr::mutate_at("Station", str_replace_all, " Rm", " RM") %>%
  dplyr::mutate_at("Station", str_replace_all, "Lb", "LB") %>%
  dplyr::mutate_at("Station", str_replace_all, "Nf", "NF") %>%
  dplyr::mutate_at("Station", str_replace_all, "Sf", "SF") %>%
  dplyr::mutate(Organization = ifelse(Organization == "OregonDEQ", "DEQ", Organization)) %>% 
  dplyr::mutate(Organization = ifelse(Organization == "11NPSWRD_WQX", "EPA WQX", Organization)) %>% 
  dplyr::mutate(Organization = ifelse(Organization == "CITY_SALEM(NOSTORETID)", "City of Salem", Organization)) %>%
  dplyr::mutate(Organization = ifelse(Organization == "USFS(NOSTORETID)", "USFS", Organization)) %>%
  dplyr::mutate(`Latitude/Longitude` = paste0(round(Lat_DD,4), "/",round(Long_DD,3))) %>%
  dplyr::mutate(`Latitude/Longitude`= ifelse(`Latitude/Longitude` == "NA/NA", NA, `Latitude/Longitude`)) %>% 
  dplyr::mutate(Org_order = ifelse(Organization == "DEQ","DEQ","Others")) %>% 
  dplyr::select(`Station ID`,Station,`Latitude/Longitude`, Organization, Org_order)

t53_1_na <- t53_1 %>% dplyr::filter(is.na(`Latitude/Longitude`))
t53_1 <- t53_1[!duplicated(t53_1$`Latitude/Longitude`),] %>% 
  dplyr::filter(!is.na(`Latitude/Longitude`)) %>% 
  rbind(t53_1_na) %>% 
  dplyr::arrange(match(Org_order,c("DEQ","Others")),Organization,`Station ID`) %>% 
  dplyr::select(`Station ID`,Station,`Latitude/Longitude`, Organization)

if(NROW(t53_1)>0){
  
  t53_1_tbl <-  knitr::kable(t53_1, format = "pandoc", padding = 2,
                             caption = tbls(name = "t53_1",
                                            caption = paste0("Continuous temperature monitoring stations in the ", qapp_project_area, " currently available in public databases and DEQ files.")))
  
}

```

All available continuous stream temperature data were retrieved from DEQ’s Ambient Water Quality Monitoring System (AWQMS). `r tbls(name = "t53_1", display="cite")` list all the locations where continuous stream temperature data were collected and the organizations that collected that data. Appendix 1 summarizes when data were collected at each station.

`r if(NROW(t53_1)>0){t53_1_tbl}`

## Stream flow data

```{r, label=`t54`, echo=FALSE}

t54_usgs <- usgs.station.tbl %>% 
  dplyr::mutate(Station = station_nm,
                `Station ID`= site_no,
                `Latitude/Longitude` = paste0(round(dec_lat_va,4), "/",round(dec_long_va,3)),
                `Data Source` = "USGS") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`,`Data Source`)

t54_hydromet <- hydromet.station.tbl %>% 
  dplyr::filter(Parameter %in% c("Discharge", "Spillway Discharge", "Flow")) %>% 
  dplyr::mutate(Station = Station.Name,
                `Station ID` = Station.ID,
                `Latitude/Longitude` = paste0(round(as.numeric(Lat),4), "/",round(as.numeric(Long),3)),
                `Data Source` = "hydromet") %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`,`Data Source`)

t54_sp <- model.input %>% 
  dplyr::filter(`Parameter` %in% c("Flow")) %>%
  dplyr::filter(!`Model Location Type` == "Point of Diversion") %>% 
  dplyr::filter(!`Data Source` == "USGS") %>% 
  dplyr::filter(is.na(`Interpolated Data`)) %>% 
  dplyr::mutate(Station = `Model Location Name`,
                `Latitude/Longitude` = ifelse(is.na(Latitude), NA, paste0(Latitude, "/", Longitude))) %>% 
  dplyr::select(`Station ID`,Station,`Latitude/Longitude`, `Data Source`)

t54 <- rbind(t54_usgs,t54_hydromet,t54_sp)
t54_na_latlong <- t54 %>% dplyr::filter(is.na(`Latitude/Longitude`))
t54_na_station_id <- t54 %>% dplyr::filter(`Station ID` == "No Station ID")
t54_na <- rbind(t54_na_latlong,t54_na_station_id)
t54_na <- t54_na[!duplicated(t54_na$Station),]
t54 <- t54[!duplicated(t54$`Latitude/Longitude`),]
t54 <- t54[!duplicated(t54$`Station ID`),] %>% 
  dplyr::filter(!is.na(`Latitude/Longitude`)) %>% 
  dplyr::filter(!`Station ID` == "No Station ID") %>% 
  rbind(t54_na) %>% 
  dplyr::arrange(`Station ID`, Station)

t54_usgs <- t54 %>% 
  dplyr::filter(`Data Source` == "USGS") %>% 
  dplyr::select(-`Data Source`)
row.names(t54_usgs) <- NULL

t54_hydromet <- t54 %>% 
  dplyr::filter(`Data Source` == "hydromet") %>% 
  dplyr::select(-`Data Source`)
row.names(t54_hydromet) <- NULL

t54_sp <- t54 %>% 
  dplyr::filter(!`Data Source` %in% c("USGS","hydromet")) %>% 
  dplyr::arrange(`Data Source`,`Station ID`,Station)
row.names(t54_sp) <- NULL

if(NROW(t54_usgs)>0){
  
  t54_usgs_tbl <- knitr::kable(t54_usgs, format = "pandoc", padding = 2, row.names = NA,
                               caption = tbls(name = "t54_usgs",
                                              caption = paste0("Continuous flow measurements available from the USGS flow gaging stations in the ", qapp_project_area, ".")))
  
}

if(NROW(t54_hydromet)>0){
  
  t54_hydromet_tbl <- knitr::kable(t54_hydromet, format = "pandoc", padding = 2, row.names = NA,
                                   caption = tbls(name = "t54_hydromet",
                                                  caption = paste0("Continuous flow measurements available from the USBR Hydromet monitoring stations in the ", qapp_project_area, ".")))
  
}

if(NROW(t54_sp)>0){
  
  t54_sp_tbl <- knitr::kable(t54_sp, format = "pandoc", padding = 2, row.names = NA,
                             caption = tbls(name = "t54_sp",
                                            caption = paste0("Flow measurements from DEQ and other public databases in the ", qapp_project_area, ".")))
  
  t54.sp.tbl.num <- tbls(name = "t54_sp", display="cite")
  
}

t54.tbl.num <- data.frame(table = c("t54_usgs","t54_hydromet","t54_sp"),
                          `nrow` = c(NROW(t54_usgs),NROW(t54_hydromet),NROW(t54_sp))) %>% 
  dplyr::filter(!`nrow` == 0)

```

`r if(NROW(t54.tbl.num) == 1){paste0(tbls(name = t54.tbl.num$table, display="cite"), " lists")} else {paste0(tbls(name = t54.tbl.num$table[1], display="cite"), " through ", tbls(name = t54.tbl.num$table[length(t54.tbl.num$table)], display="cite"), " list")}` the stations for flow volume data and other instream measurements that were available in USGS, DEQ, and other public databases.

`r if(NROW(t54_usgs)>0){t54_usgs_tbl}`
`r if(NROW(t54_hydromet)>0){t54_hydromet_tbl}`
`r if(NROW(t54_sp)>0){t54_sp_tbl}`

## Point source discharges

```{r, label=`t55`, echo=FALSE}

section.npdes.ind <- npdes.ind %>% 
  dplyr::filter(`Project Area` %in%  qapp_project_area) %>%
  dplyr::mutate(`Facility Name (Facility Number)` = paste0(`Common Name`," (", `WQ File Nbr`,")"),
                `Latitude/Longitude` = paste0(round(Latitude,4), "/",round(Longitude,3)),
                `Permit Type and Description` = paste0(`Permit Type`, ": ", `Permit Description`),
                `River Mile` = round(`River Mile`,1),
                `Stream/River Mile` = ifelse(is.na(`Stream Name`), NA, paste0(`Stream Name`, " ", " RM ",`River Mile`))) %>% 
  dplyr::select(`Facility Name (Facility Number)`, `Latitude/Longitude`,`Permit Type and Description`, `Stream/River Mile`) %>% 
  dplyr::arrange(`Facility Name (Facility Number)`)

if(NROW(section.npdes.ind)>0){
  
  t55_ind_tbl <- knitr::kable(section.npdes.ind, format = "pandoc", padding = 2,
                              caption = tbls(name = "t55_ind",
                                             caption = paste0("Summary of individual NPDES permitted discharges in the ", qapp_project_area, ".")))
  
}

section.npdes.gen <- npdes.gen %>% 
  dplyr::filter(`Project Area` %in%  qapp_project_area)%>%
  dplyr::mutate(`Permit Type and Description` = paste0(PermitType, ": ", PermitDescription)) %>% 
  dplyr::group_by(`Permit Type and Description`) %>% 
  dplyr::summarise(`Current Number of Registrants` = n()) %>% 
  dplyr::ungroup()

if(NROW(section.npdes.gen)>0){
  
  t55_gen_tbl <- knitr::kable(section.npdes.gen, format = "pandoc", padding = 2,
                              caption = tbls(name = "t55_gen",
                                             caption = paste0("Summary of current general NPDES permit registrants in the ", qapp_project_area, ".")))
  
}

```

`r if(NROW(section.npdes.ind)>0){tbls(name = "t55_ind", display="cite")}else{paste0("[Update: No individual NPDES permits]")}` identifies all the active individual NPDES permittees in the `r qapp_project_area`. Many of these permittees submit Discharge Monitoring Reports (DMRs) as a condition of their permit. Depending on the monitoring requirements in the permit, some permittees are required to report effluent temperature and effluent flow rates in the DMR. The frequency and type of reporting varies by permit and permit type. Some permits only require monthly, weekly, or daily grab samples while others require summary statistics such as daily maximum, daily mean, or seven day average daily maximum. Where possible, DEQ will utilize any continuous effluent data that has been provided to DEQ. When continuous data is not available, DMR data will be utilized to characterize point source discharges. `r tbls(name = "t55_gen", display="cite")` lists all the active general NPDES permitting types in the `r qapp_project_area`.

`r if(NROW(section.npdes.ind)>0){t55_ind_tbl}`
`r if(NROW(section.npdes.gen)>0){t55_gen_tbl}`

## Water rights/surface water diversions

Data on surface water diversion rates (usage) and the points of diversion (location) are available from the Oregon Water Resources Department (OWRD). OWRD regulates all commercial, industrial, domestic, and agricultural water use in the state of Oregon through water rights.

Estimates of water diversion rates and location of points of diversion can be derived from the following OWRD sources:

* [Water Rights Information System][WRIS] (WRIS) – the WRIS database contains all permitted or certificated water rights. Data in the WRIS corresponding to quantities of water for use are expressed as maximum use allowable, generally as monthly, seasonal or annual rates or volumes. These maximum values may not correspond to actual usage, which will likely vary based on factors such as irrigation application rate or household consumer demand. DEQ may choose to incorporate the maximum amount allowable or some lesser quantity provided sufficient information is available to support those rates in the modeling.  Water rights information can also be accessed using their online mapping application (https://apps.wrd.state.or.us/apps/gis/wr/Default.aspx).

* [Water Use Reports][Water Use Reports] – some, but not all, water rights holders must monitor and report the water they use to the state, typically on a monthly or yearly basis, as a requirement of their water rights. These water use reports will be used to develop withdrawal time series based on the information at hand.

[WRIS]: https://www.oregon.gov/owrd/programs/WaterRights/WRIS/Pages/default.aspx
[Water Use Reports]: https://apps.wrd.state.or.us/apps/wr/wateruse_query/

## Effective shade measurements

```{r, label=`t56`, echo=FALSE}

t56 <- model.input %>% 
  dplyr::filter(`Parameter` %in% c("Effective Shade")) %>% 
  dplyr::filter(is.na(`Interpolated Data`)) %>% 
  dplyr::mutate(Station = `Model Location Name`,
                `Latitude/Longitude` = ifelse(is.na(Latitude), NA, paste0(Latitude, "/", Longitude))) %>% 
  dplyr::select(`Station ID`, Station, `Latitude/Longitude`, `Data Source`) %>% 
  dplyr::arrange(`Station ID`)

t56_na <- t56 %>% dplyr::filter(is.na(`Latitude/Longitude`))
t56 <- t56[!duplicated(t56$`Latitude/Longitude`),] %>% 
  dplyr::filter(!is.na(`Latitude/Longitude`)) %>% 
  rbind(t56_na) %>% 
  dplyr::arrange(`Data Source`,`Station ID`,Station)

if(NROW(t56)>0){
  
  t56_tbl <- knitr::kable(t56, format = "pandoc", padding = 2,
                          caption = tbls(name = "t56",
                                         caption = paste0("Effective shade data collected in the  ", qapp_project_area, ".")))
  
}

```

**[Update: Remove this section if there is no effective shade data.]**Effective shade is the percent of potential daily solar radiation flux delivered to the stream surface. DEQ and/or partner agency staff used an instrument called a Solar Pathfinder to collect effective shade measurements in the field. `r if(NROW(t56)>0){paste0(tbls(name = "t56", display="cite")," lists the stations for effective shade measurements that were available in public and DEQ databases.")} else {paste0("There are no effective shade data available to DEQ or within publically accessible databases in the ", qapp_project_area, ".")}`

`r if(NROW(t56)>0){t56_tbl}`

# Model development and calibration

## Source characteristics

Temperature is the water quality parameter of concern, but heat, in particular heat from human activities or anthropogenic sources, is the pollutant of concern. Specifically, water temperature change is an expression of heat flux to waterbody (Equation 1).   

$$\Delta Temperature = \frac{\Delta Heat}{Density\times \text {Specific Heat}\times \Delta \text {Flow Volume}}  \hspace{3em}\text{Equation 1}$$

Stream temperature is influenced by natural factors such as climate, geomorphology, hydrology, and vegetation. Human or anthropogenic heat sources may include discharges of heated water to surface waters, increases solar radiation heat flux on the water’s surface due to the removal of near-stream vegetation and reductions in stream shading, changes to stream channel form, reductions in natural stream flows, and the reduction of cold water inputs from groundwater.

## General model parameters

```{r, label=`chap6`, include=FALSE}

tmdl.mod.tbl <- knitr::kable(tmdl.mod.1, format = "pandoc", padding = 2,
                             caption = tbls(name = "tmdl.mod",
                                            caption = paste0("Models used in the development of the ", pro.area.tmdls, ".")))

# model versions
tmdl.mod.2 <- model.info %>% 
  dplyr::distinct(Model_version,`QAPP Project Area`,`Primary Model Parameter`,Model_version,mod_rmd,mod_score)

mod.check <- sum(as.numeric(tmdl.mod.2$mod_score))

mod.v <- NULL

if(mod.check == "11"){
  
  modv <- tmdl.mod.2 %>% 
    dplyr::filter(!mod_rmd %in% c("hs6","hs7"))
  
  if(NROW(modv)>0){
    
    for(mod in unique(sort(modv$mod_rmd))){
      
      mod.child <- paste0(mod,".Rmd")
      
      mod.v <- c(knitr::knit_child(input = "hs6.Rmd", envir = globalenv()),
                 knitr::knit_child(input = "hs67.Rmd", envir = globalenv()),
                 knitr::knit_child(input = mod.child, envir = globalenv()))
      
    }
    
  } else {
    
    mod.v <- c(knitr::knit_child(input = "hs6.Rmd", envir = globalenv()),
               knitr::knit_child(input = "hs67.Rmd", envir = globalenv()))
    
  }
  
} else {
  
  if(mod.check == "21"){
    
    modv <- tmdl.mod.2 %>% 
      dplyr::filter(!mod_rmd %in% c("hs6","hs8"))
    
    if(NROW(modv)>0){
      
      for(mod in unique(sort(modv$mod_rmd))){
        
        mod.child <- paste0(mod,".Rmd")
        
        mod.v <- c(knitr::knit_child(input = "hs6.Rmd", envir = globalenv()),
                   knitr::knit_child(input = "hs68.Rmd", envir = globalenv()),
                   knitr::knit_child(input = mod.child, envir = globalenv()))
        
      }
      
    } else {
      
      mod.v <- c(knitr::knit_child(input = "hs6.Rmd", envir = globalenv()),
                 knitr::knit_child(input = "hs68.Rmd", envir = globalenv()))
      
    }
    
  } else {
    
    if(mod.check == "31"){
      
      modv <- tmdl.mod.2 %>% 
        dplyr::filter(!mod_rmd %in% c("hs6","hs7","hs8"))
      
      if(NROW(modv)>0){
        
        for(mod in unique(sort(modv$mod_rmd))){
          
          mod.child <- paste0(mod,".Rmd")
          
          mod.v <- c(knitr::knit_child(input = "hs6.Rmd", envir = globalenv()),
                     knitr::knit_child(input = "hs67.Rmd", envir = globalenv()),
                     knitr::knit_child(input = "hs68.Rmd", envir = globalenv()),
                     knitr::knit_child(input = mod.child, envir = globalenv()))
          
        }
        
      } else {
        
        mod.v <- c(knitr::knit_child(input = "hs6.Rmd", envir = globalenv()),
                   knitr::knit_child(input = "hs67.Rmd", envir = globalenv()),
                   knitr::knit_child(input = "hs68.Rmd", envir = globalenv()))
        
      }
      
    } else {
      
      for(mod in unique(sort(tmdl.mod.2$mod_rmd))){
        
        mod.child <- paste0(mod,".Rmd")
        mod.v <- c(mod.v, knitr::knit_child(input = mod.child, envir = globalenv()))
        
      }
    }
  }
}

```

The following models were used in the development of the `r paste0(pro.area.tmdls, " (", knitr::combine_words(strip_alpha(unique(sort(model.info$"Abbreviated Reference")))), ")")` for the associated waterbodies (`r tbls(name = "tmdl.mod", display="cite")`).

`r tmdl.mod.tbl`

Model calibration was completed by DEQ and described in `r paste0(pro.area.tmdls, " (", knitr::combine_words(strip_alpha(unique(sort(model.info$"Abbreviated Reference")))), ")")`. **[Update: It is unlikely that adjustments to the existing calibrated model will occur as part of this project.]** If it is determined at a later date the calibration needs to be updated the model inputs that are expected to be modified to improve model fit are described in this section. An improved model fit is defined as an improvement to the model fit statistics described in Section 7 Model Evaluation and Acceptance and generally represents improved agreement between measured observations and model predictions.

`r paste(mod.v, collapse = "\n")`

## Data gaps

Non-steady state stream models typically require a significant amount of data because of the large spatial and temporal extents the models typically encompass. As the model size or modeling period increase, the amount of information needed to parameterize it also increases. Often it is not possible to parametrize a model entirely from field data because it can be resource intensive or impractical to collect everything that is needed. In general, these data gaps may be considered and addressed in a number of ways. `r tbls(name = "data.gap", display="cite")` summarizes methods that are used to derive the data needed to parametrize the model.

To the greatest extent possible, the method used to derive the model parameters for the existing TMDL models have been summarized in the boundary conditions and tributary inputs tables in the Model Parameters sections in the current Chapter 6  Model Development and Calibration.

```{r, label=`data_gap`, echo=FALSE}

# tdata.gap <- 

print(knitr::kable(data.gap, format = "pandoc", padding = 2,
                   caption = tbls(name = "data.gap",
                                  caption = paste0("Methods to derive model parameters for data gaps."))))

```

```{r,label=`shadow`, echo=FALSE}

if("SHADOW" %in% tmdl.mod.1$`Model Version`){
  
  shadow <- model.info %>% 
    dplyr::filter(`Model version` == "SHADOW") %>% 
    dplyr::select(`Model Waterbody`,`Model Extent Distance`,`Model Extent Units`,`TMDL Document`) %>%
    dplyr::arrange(as.numeric(`Model Extent Distance`))
  
  
  names(shadow)[names(shadow) == "Model Extent Distance"] <- if(NROW(shadow)>0){paste0("Model Extent (",unique(shadow$`Model Extent Units`),")")}
  
  shadow_tbl <-  knitr::kable(shadow[,c(1:2)], format = "pandoc", padding = 2,
                              caption = tbls(name = "shadow",
                                             caption = paste0("SHADOW model waterbodies in the ", qapp_project_area,".")))
  
  cat("## SHADOW\n")
  
  cat(paste0("DEQ used USFS SHADOW shade modeling results in its development for the original ", knitr::combine_words(unique(sort(shadow$'TMDL Document'))), ". DEQ does not intend to update any of the stream segments in the ",qapp_project_area, " where SHADOW was utilized.  If the need arises to revisit some of the SHADOW modeling, this QAPP will be updated at that time to inform the project team on how to proceed."))
  
  cat("\
  
      ")
  cat("\n")
  
  cat("### Model Domain\n")
  
  cat(paste0("The SHADOW model domain includes all of the streams identified in ", tbls(name = "shadow", display="cite"), ". Typically the extent is the entire length of the stream from mouth to headwaters."))
  
  print(knitr::kable(shadow[,c(1:2)], format = "pandoc", padding = 2,
                     caption = tbls(name = "shadow",
                                    caption = paste0("SHADOW model waterbodies in the ", qapp_project_area,"."))))
  
} else {}

```

```{r, label=`chap6x`, include=FALSE}

# Note: SHADOW model streams were not included in Section 6 sub-sections of Model Waterbodies
chap6 <- NULL

for(waterbody_name in unique(sort(model.info[!model.info$`Model version` == "SHADOW",]$`Model Waterbody`))){
  
  if(!qapp_project_area == "North Umpqua Subbasin"){
    
    chap6 <- c(chap6, knitr::knit_child(input = "chap6.Rmd", envir = globalenv()))
    
  } else {
    
    chap6 <- c(chap6, knitr::knit_child(input = "chap6_nu.Rmd", envir = globalenv()))
  }
  
}

```

`r paste(chap6, collapse = "\n")`

# Model evaluation and acceptance

## Model uncertainty and sensitivity

Model uncertainty can arise from a number of sources including error associated with measuring field parameters used for model input or calibration, lack of knowledge on the appropriate value to use for model parameters or constants, or an imperfect mathematical formulation in the model of real world physical processes. A model’s sensitivity is the degree to which predictions are affected by changes in a single or multiple input parameters.

In many cases, the major source of uncertainty is due to uncertainty in spatial representation of the river channel and adjacent landcover (e.g., bathymetry, vegetation height and density) from lack of data or simplification, configuration of the boundary conditions (e.g., uncertainty in estimation of ungaged tributary flows or temperatures), and uncertainty from limited amount or spatial distribution of observed data used for calibration. These sources of uncertainty are largely unavoidable, but do not invalidate the use of the model for decision purposes. 

During the calibration process, it is good practice to evaluate and minimize uncertainty associated with the model parameters to the greatest extent practical (Beck, 1987; EPA, 2009). During the model calibration process, the responsiveness of the model predictions to various assumptions and rate constants should be evaluated. The model setup should include parameters based on literature recommendations and best professional judgment.

Reducing uncertainty in measured field parameters used for model input and calibration is accomplished in the following ways:

*	Data used for the TMDL must have been collected based on a project plan with quality assurance and quality control protocols for collecting and analyzing samples.    

*	The sampling and laboratory analysis must follow widely accepted scientific methods and protocols. These may include DEQ-MOMs, USEPA, USGS and Standard Methods for the Examination of Water and Wastewater. All acceptable methods include applicable precision and accuracy checks.    

*	When possible, accuracy and precision should be evaluated using DEQ’s data validation criteria as outlined in DEQ Data Quality Matrix for Field Parameters (DEQ, 2013). The TMDL program uses waterbody results that demonstrate a data quality level of A, B, or E with careful review. For continuous temperature data a data quality of A or B corresponds to an absolute accuracy $\le$ 1.0 $^\circ C$ and absolute precision $\le$ 2.0 $^\circ C$. Data of unknown quality lacking audit and prepost accuracy checks may also be used following a careful review where it is determined the results appear reasonable and free of issues based on professional judgment.    

Uncertainties in the mathematical formulation are addressed by using open source models that allow free and transparent inspection of model code; and models that have had their methodologies peer reviewed and evaluated.

The existing **[Update: A, B, and C]** models were extensively evaluated to determine uncertainty in **[Update: X, and Y]**. **[Update: A sensitivity analysis was also completed on Z]**. A discussion of the methodology used to evaluate uncertainty and sensitivity is found in **[Updated: citation]**. **[Update: This paragraph should be manually edited for each QAPP with the relevant details.]**

It is not anticipated that additional uncertainty or sensitivity analyses will be performed on the existing calibrated models. 

## Model acceptance

This section identifies the model acceptance criteria. Model acceptance relies on satisfying seven (7) conditions:

1)	Incorporation of all available field observations of the system (e.g., geometry, flow, boundary inputs/withdrawals, and meteorology) for the time period simulated.    

2)	Model parameters and unmeasured boundary conditions that are within literature-supported and physically defensible ranges.    

3)	Model predicted results have been compared with the associated observed measurements using graphical presentations. Visual comparisons are useful in evaluating model performance over the appropriate temporal or spatial scales.    

4)	Calibration error statistics have been calculated comparing the model predicted results to the associated observed measurements. The calibration error statistics are shown in Equation 2 through Equation 5.    

5)	Calibration error statistics have been used to inform the appropriate use of the model. Where a model achieves an excellent fit it can generally assume a strong role in evaluating management options. Conversely, where a model achieves only a fair or poor fit it should assume a much less prominent role in the overall weight-of-evidence evaluation of management options. If a desired level of quality is not achieved on some or all measures, the model might still be useful; however, a detailed description of its potential range of applicability will be provided.    

6)	Written documentation of all important elements in the model, including model setup, model parameterization, key assumptions, and known areas of uncertainty.    

7)	Peer review as described in Section 9.    

Equation 2 through Equation 5 are the error statistics to be calculated for each calibrated model.

**Mean Error (ME)**: A mean error of zero indicates a perfect fit. A positive value indicates on average the model predicted values are less than the observed data. A negative value indicates on average the model predicted values are greater than the observed data. The mean error statistic may give a false ideal value of zero (or near zero) if the average of the positive deviations between predictions and observations is about equal to the average of the negative deviations in a data set. Because of this, the mean absolute error (MAE) statistic should be used in conjunction with mean error to evaluate model performance.

$$ME = \frac{1}{n}\sum(X_{mod} - X_{obs}) \hspace{3em}\text{Equation 2}$$ 

**Mean Absolute Error (MAE)**: A mean absolute error of zero indicates a perfect fit. The magnitude of the mean absolute error indicates the average deviation between model predicted values and observed data. The mean absolute error cannot give a false zero.

$$MAE = \frac{1}{n}\sum|X_{mod} - X_{obs}|  \hspace{3em}\text{Equation 3}$$

**Root Mean Square Error (RMSE)**: A root mean square error of zero indicates a perfect fit. Root mean square error is a measure of the magnitude of the difference between model predicted values and observed data.

$$RMSE = \sqrt{\frac{1}{n}\sum(X_{mod} - X_{obs})^2} \hspace{3em}\text{Equation 4}$$

**Nash-Sutcliffe efficiency coefficient (NS)**: Nash-Sutcliffe efficiencies can range from -$\infty$ to 1. An efficiency of 1 corresponds to a perfect match of modeled predicted value to the observed data. An efficiency of 0 indicates that the model predictions are as accurate as the mean of the observed data, whereas an efficiency less than zero occurs when the observed mean is a better predictor than the model.

$$NS = 1 - \frac {\sum (X_{mod} - X_{obs})^2}{\sum (X_{mod} - \overline{X_{obs}})^2}  \hspace{3em}\text{Equation 5}$$

where,  
$X_{mod}$ = The model predicted results;  
$X_{obs}$ = The observed or measured results;  
$\overline X_{obs}$ = The mean of the observed or measured temperature;  
$n$ = The sample size.

# Documentation in model reports

The existing TMDL technical appendices will be cited or added to the replacement TMDL as new appendices if those documents contain information supporting replacement TMDL results or decisions. The existing technical appendices will be amended as necessary to document any modifications, updates, or new models that have been developed.

# Peer review

Peer review of the models and model results will be conducted in the following ways:

DEQ will conduct internal peer review during the modeling process with input from EPA Region 10 as needed.

DEQ will consider feedback on model scenarios and results from the TMDL advisory group and make changes as appropriate.

DEQ will review and respond to any public comments received on the model and model results, and make changes as appropriate.

# Management scenarios

Management scenarios described in this section summarize means by which the current conditions and possible alternatives will be evaluated. Some or all of these scenarios will be executed and assessed in the modeling.

## Current conditions

This scenario evaluates the stream temperature response under current existing conditions. This scenario is similar to the calibrated model except that some sources conditions will be modified, may be removed, or new ones added to reflect the current conditions or discharge loads if they are significantly different from the calibrated model. Elements of this scenario include:

**[List specific changes that will be made]**

## Background

This scenario evaluates the stream temperature response from background sources only. Background sources include all sources of pollution or pollutants not originating from human activities. Background sources may also include anthropogenic sources of a pollutant that DEQ or another Oregon state agency does not have authority to regulate, such as pollutants emanating from another state, tribal lands, or sources otherwise beyond the jurisdiction of the state (OAR 340-042-0030(1)). This scenario essentially combines the following model scenarios: restored vegetation, restored stream flow, improvements to channel morphology, and potentially elements of the climate scenario. The background scenario will be compared to the current conditions model scenario to determine the point of maximum impact, and the amount of cumulative warming originating from human activities that DEQ or another Oregon state agency have authority to regulate.

## Restored vegetation

This scenario evaluates the stream temperature response with streamside vegetation at restored conditions. The stream temperature warming or cooling contributed by removal of streamside vegetation is evaluated by comparing this scenario to the current condition model. Elements of this scenario include:

* Restoring streamside vegetation in areas along the model extent that are currently characterized as lacking streamside vegetation because of anthropogenic disturbance. The restored vegetation type, height, density, and overhang are identified in the `r paste0( pro.area.tmdls, " (", knitr::combine_words(strip_alpha(unique(sort(model.info$"Abbreviated Reference")))), ")")`.

*	Model inputs for land cover height, canopy density, and overhang will be modified to reflect the restored conditions.

*	All other model inputs will be the same as the current condition model.

## Protected vegetation

This scenario evaluates the stream temperature response from only streamside vegetation along the stream that is currently protected by statue, rule, ordinance, or some other approved management plan (voluntary or regulatory). The purpose of this scenario is to determine the stream temperature warming or cooling contributed by removal of streamside vegetation in unprotected areas and if existing management strategies achieve surrogate measure effective shade targets. This scenario may be a subset of the TMDL implementation scenario. The stream temperature warming or cooling is evaluated by comparing this scenario to the current condition model. Attainment of the effective shade targets is evaluated by comparing this scenario to the background model scenario.  Elements of this scenario include:

*	Identifying streamside vegetation areas along the model extent that are protected and will not be removed. The exact definition of a protected area will be determined during the TMDL process.    

*	Model inputs for land cover height, density, and overhang will be set to zero outside of protected areas.     

*	Model inputs for land cover height, density, and overhang inside a protected areas will be set to current conditions.    

*	All other model inputs will be the same as the current condition model.    

## Restored stream flow

This scenario evaluates stream temperature response by maintaining permitted water withdrawals as instream flow. The stream temperature warming or cooling from keeping permitted water withdrawals as instream flow is evaluated by comparing this scenario to the current conditions model scenario. Elements of this scenario include:

*	Maintaining all currently permitted water withdrawals as instream flow in order to increase the thermal loading capacity and reduce stream warming.    

*	Model boundary and tributary flows will be set to reflect the additional instream flows.    

*	All other model inputs will be the same as the current condition model.    

## Tributary temperatures

This scenario evaluates the stream temperature response from restoration actions on tributaries. The stream temperature warming or cooling contributed by removal of streamside vegetation on tributaries is evaluated by comparing this scenario to the current condition model. Elements of this scenario include:

*	Tributary inputs will be set to reflect restored temperature and flow conditions. The tributary flow will reflect maintaining all currently permitted water withdrawals as instream flow.    

*	All other model inputs will be the same as the current condition model.    

## Climate

This scenario evaluates the stream temperature response from changes in air temperature and relative humidity connected to human caused changes to global or micro climate conditions. Warming or cooling from climate related impacts will be evaluated by comparing this scenario to the current conditions model scenario. Elements of this scenario include:

*	Model inputs for air temperature and relative humidity may be modified to reflect potential conditions or improved climate change scenarios if enough information exists that would allow downscaling to the site specific conditions in model extent.    

*	Model inputs for groundwater or stream flow may also be modified if sufficient information exists that would allow downscaling to the site specific conditions in model extent.    

*	All other model inputs will be the same as the current condition model.    

## Channel morphology

This scenario evaluates stream temperature response from improvements to channel morphology, including projects to restore cold water refuges. The warming or cooling from channel morphology improvements is evaluated by comparing this scenario to the current conditions model scenario. Elements of this scenario include:    

*	Modifying channel width and/or depth to reflect locations where improvements to channel morphology are needed. The location of channel morphology projects will be determine during the TMDL process.    

*	Model configurations for bottom width, channel angle z, manning’s n, gradient, elevation, porosity, percent hyporheic flow, hyporheic zone thickness, land cover height, density, and overhang may be modified in areas with improved channel morphology.    

* All other model inputs will be the same as the current condition model.    

## No point sources

This scenario evaluates the stream temperature response from removing point source heat load. The stream temperature warming or cooling from permitted NPDES point sources is evaluated by comparing. This scenario to the current conditions model scenario. Elements of this scenario include:    

*	Removal of all point sources from the model.    

*	All other model inputs will be the same as the current condition model.     

## TMDL waste load allocations

This scenario evaluates stream temperature warming or cooling from the TMDL Waste Load Allocations. These scenarios will be compared to the background model scenario to evaluating attainment of the human use allowance allocations. Elements of this scenario include:    

*	Modifying point source discharges to reflect proposed or existing TMDL Waste Load Allocations.    

*	All other model inputs will be the same as the current condition model.    

## TMDL implementation plans

This set of scenarios evaluate the stream temperature response from proposed or existing DMA and responsible person TMDL implementation plans. These scenarios will be compared to the background model scenario to evaluate attainment of the human use allowance allocations. It is likely that multiple model scenarios will be developed evaluating a single implementation plan or multiple implementation plans together. Elements of this scenario include:    

*	Modifying streamside vegetation, instream flow, and/or channel morphology to reflect the proposed or existing implementation plan. Translating the plan elements to the modeled landscape conditions will be determined during the TMDL process.    

*	Model inputs for land cover height, density, overhang, boundary condition flow and temperature, bottom width, channel angle *z*, Manning’s *n*, porosity, percent hyporheic flow, and hyporheic zone thickness, may be modified.    

*	All other model inputs will be the same as the current calibrated model.    

# Project organization

## Project team/roles

```{r, label=`roles`, echo=FALSE}

troles <- flextable::regulartable(roles) %>% 
  flextable::set_table_properties(layout = "autofit") %>% 
  #flextable::merge_h(i = c(1,13)) %>% 
  #flextable::bold(i = c(1,13)) %>% 
  flextable::bg(i = 1, bg = "#B52222", part = "body") %>% 
  flextable::valign(valign = "top") %>% 
  flextable::theme_box() %>% 
  flextable::set_caption(tbls(name = "roles",
                              caption = paste0("The roles and responsibilities of each team member involved in the temperature TMDL replacement project.")))

```

Project roles and responsibilities are described in `r tbls(name = "roles", display="cite")`.

`r troles`

## Expertise and special training requirements

Additional expertise or special training is not necessary at this time.

DEQ staff involved in developing and configuring models, performing model calibration, running model scenarios, and analyzing and interpreting model results have experience in these tasks from numerous other modeling projects. The Project Manager has extensive experience managing large complex projects and will ensure strict adherence to the project protocols.

## Reports to management

The DEQ Project Manager (or designee) will provide monthly progress reports to DEQ Management and USEPA. As appropriate, these reports will provide information on the following:

*	Adherence to project schedule and/or budget
*	Deviations from approved QAPP, as determined from project assessment and oversight activities
*	The impact of any deviations on model application quality and uncertainty
*	The need for and results of response actions to correct any deviations
*	Potential uncertainties in decisions based on model predictions and data
*	Data quality assessment findings regarding model input data and model outputs

## Project schedule

The project schedule for the `r qapp_project_area` TMDL is scheduled to occur in two phases. The pre TMDL project phase, and the TMDL and WQMP development phase.

**Pre TMDL project phase**

The pre TMDL project phase will generally occur between January 2020 through the end of March 2022. In this phase most of the planning and technical work occurs. Specific tasks include:

**Task P1** Data gathering and project organization.

|       **P1.1** Organize and gather effluent data from all active NPDES permittees in the temperature TMDL replacement project area.     

|       **P1.2** Organize and gather all available and relevant river temperature, stream flow, habitat, effective shade, and channel morphology.       

|       **P1.3** Complete an open data solicitation.  During the solicitation period, the public may submit continuous stream temperature data and NPDES effluent data to DEQ in the watersheds subject to the temperature TMDL replacements.     

|       **P1.4** Review data collected. Data submitted to DEQ will be screened for completeness and quality, and whether the results are within the typical range expected for that season and time of day.     

|       **P1.5** Stream temperature data will be made available in DEQ’s Ambient Water Quality Monitoring System database (AWQMS).     

**Task P2** Develop modeling Quality Assurance Project Plans (QAPPs).  The modeling QAPPs will identify the available data and overall technical approach to be taken for each TMDL project.     

**Task P3** Mapping of Designated Management Agencies (DMAs) and Responsible Persons for counties that are within the project area. All Oregon counties are within the project area except Tillamook and Clatsop, and Deschutes counties.     

**Task P4** Development of computer code to streamline analysis tasks and TMDL document production.     

**Task P5** Development of template TMDL and WQMP section outline and language.     

**Task P6** Implement Modeling QAPPs. This task a follow-up to Task P2. Gathering of new data and completion of new technical described in the modeling QAPPs.     

**TMDL and WQMP development phase**    

The TMDL and WQMP development phase is scheduled to begin on `r format(qapp_project_areas[which(qapp_project_areas$areas == qapp_project_area),]$Task.1.Start,"%B %d, %Y")` with EPA’s final agency action approving or disapproving of the TMDL no later than `r format(qapp_project_areas[which(qapp_project_areas$areas == qapp_project_area),]$EPA.Approval,"%B %d, %Y")`. In this phase, the draft TMDL and WQMP documents will be written; a TMDL advisory committee will be convened to discuss the updated TMDL allocations and any revisions to the WQMP; and finally DEQ will conduct a public comment period. DEQ will respond to all public comments received, revise the TMDL and WQMP as necessary, and issue the final TMDL to EPA for their action.

# Data management

DEQ does not anticipate collecting additional field samples. Water quality data gathered and used for this project will be managed in DEQ’s AWQMS database or the project files.

The modeling software to be used for this project is available on DEQ’s TMDL program website (https://www.oregon.gov/deq/wq/tmdls/Pages/TMDLs-Tools.aspx). 

Model-generated data resulting from testing, calibration, and scenarios will be stored in spreadsheets and text files by DEQ in TMDL project directory.  Metadata describing the content, date, and personnel involved in modeling will be documented alongside raw and summarized data.

Secondary data developed as part of this task will be maintained as hardcopy only, both hardcopy and electronic, or electronic only, depending on their nature. 

All electronic data will be maintained on DEQ’s computers and servers. DEQ’s computers are serviced by in-house specialists. When a problem with DEQ’s computers and servers occurs, in-house computer specialists diagnose the problem and correct it if possible. When outside assistance is necessary, the computer specialists call the appropriate vendor. For other computer equipment requiring outside repair and not covered by a service contract, local computer service companies are used on a time-and-materials basis. 

Routine maintenance of DEQ’s computers and servers is performed by in-house computer specialists. Electric power to each computer flows through a surge suppressor to protect electronic components from potentially damaging voltage spikes. All computer users have been instructed on the importance of routinely archiving work assignment data files from hard drive to server storage. The office network server is backed up on tape nightly during the week. Screening for viruses on electronic files loaded on DEQ’s computers or the network is standard policy. Automated screening systems have been placed on all computer systems and are updated regularly to ensure that viruses are identified and destroyed. Annual maintenance of software is performed to keep up with evolutionary changes in computer storage, media, and programs.

# Recordkeeping and archiving

All data and documents generated during the course of the TMDL project will be achieved according to the current Oregon State Archives Records Retention Schedules. Generally TMDL documents will be retained until 15 years after the TMDL is no longer operational.

The following information will be included in hard copy or electronic format in the TMDL project and Master TMDL folders located on DEQ’s TMDL server.

The project folder will contain at minimum the following subfolders:

Project Plans: All documents related to project planning, project proposals, project schedules, and the QAPPs. Each will reside in their relevant subfolders. The final versions of documents will be clearly identified from drafts and ideally located in separate folders.

Data: All field data organized or collected in support of the TMDL project. This may include water quality samples, NPDES effluent data, field sheets, photos, monitoring metadata, sampling project plans, QAPPS, or other documentation. The data should be organized by parameter and data source if possible.

Models: All models used for the TMDL project including calibration and scenario models. The models should be organized into subfolders for each model domain and model scenario. Draft models and the final TMDL model will be clearly identified and ideally in separate folders. The model folders should include:

*	The model with all input and outputs files; and any executable code used    

*	Copy of all raw and summarized data (including GIS files) used for model input with data source and location metadata included    

*	Scripts or spreadsheets used to transform raw data or used to derive model inputs    

*	Key assumptions and documentation for the model setup and parameterization    

*	Documentation of newly developed model code or modifications to the existing model    

*	Identification of staff that completed the model.

Meetings: All documents produced for external meetings including agendas, presentations, posters, and meeting handouts. Material for each meeting will be saved in a subfolder organized by date and meeting type. For example the folder name for the first meeting of the TMDL advisory group (AG) would be “2022-08-15 Temperature AG 1”. Draft documents and final documents will be clearly identified and ideally in separate folders.

TMDL documents: At each key stage of TMDL and WQMP development copies of the following documents will be saved in separate subfolders within the project folder on the Master TMDL directory.

*	Briefing Memo to DEQ Water Quality Division Administrator or Director.    

*	Public Comment Draft:     

+	Public Comment Draft TMDL and WQMP Report (Both Word and PDF)    

+	Draft TMDL Appendices (Both Word and PDF)    

+	Public Notice document    

+	TMDL Summary Fact Sheet    

+	News release    

+	GovDelivery Notice and email    

+	Other public notification emails    

+	Mailing List (if used)    

+	Public Comments Errata    

*	Public Comments Received: Copy of all public comments received    

*	Final TMDL and WQMP documents:    

+	TMDL signed Order (both Word and PDF)    

+	TMDL issuance letter to EPA (both Word and PDF)    

+	EPA approval letter (EPA)    

+	Response to Comment Document (both Word and PDF)    

+	TMDL and WQMP Report (both Word and PDF)    

+	TMDL Appendices (both Word and PDF)    

+	TMDL Summary Fact Sheet    

+	News release    

+	GovDelivery Notice and email    

+	Other public notification emails    

+	DMA/RP notification letters (both Word and PDF)    

+	Addendums    

+	Errata    

+	Petitions    

+	Director’s Petition Action (acceptance or rejection of petition)    

+	Response to Petition    

+	Attains upload files    

# QAPP review and approval

The DEQ Project Technical Lead will distribute the draft QAPP to the respective DEQ and EPA project team members for review. Comments will be provided to the Project Technical Lead for further discussion if appropriate and revision and submittal of the final plan within 10 business days of receipt of comments. Following approval, the Project Technical Lead will distribute the final, signed copy to their respective staff assigned to the project. Official copies of the final, approved QAPP will be retained. If any change(s) in the QAPP are required during the project, they must be described in a memorandum and approved by the signatories to this QAPP and attached to the QAPP.

# Implementation and adaptive management

```{r, label=`risk`, echo=FALSE}

trisks <- knitr::kable(risks, format = "pandoc", padding = 2,
                       caption = tbls(name = "risks",
                                      caption = paste0("Projects risks and proposed solutions.")))

```

DEQ plans to develop a Risk Management Plan to identify project constraints, the risks that may arise during project implementation, and potential solutions. Identified project constraints include the abbreviated project schedule with hard deadlines established via court order, limited resources, uncertain funding from EPA, and a complex TMDL technical effort which may require additional time and public process. Projects risks from these constraints and proposed solutions are described in `r tbls(name = "risks", display="cite")`. 

`r trisks`

Should a situation arise that requires a significant change in the technical approach, the project team will update the QAPP as needed through revisions or addenda.

\newpage
# References

```{r, label=`qapp_ref`, echo=FALSE}

tmdl.ref <- model.info %>%
  dplyr::distinct(`TMDL Document`, `Abbreviated Reference`) %>% 
  dplyr::left_join(ref, by = "Abbreviated Reference") %>% 
  dplyr::mutate(`Abbreviated Reference` = strip_alpha(`Abbreviated Reference`)) %>% 
  dplyr::mutate(reference = paste(`Full Reference`, ifelse(is.na(`Reference Link`),"",`Reference Link`))) %>% 
  dplyr::select(reference)

tir.ref <- data.frame(unique(sort(t52$Reference))) %>% 
  dplyr::rename(reference = "unique.sort.t52.Reference..")

mod.ref <- model.info %>% 
  dplyr::filter(!is.na(mod_ref)) %>% 
  dplyr::rename(reference = mod_ref) %>% 
  dplyr::select(reference)


other.ref <- data.frame(reference = c(
  'Beck, M.B. 1987. "Water Quality Modeling: A Review of the Analysis of Uncertainty". Water Resources Research 23(8), 1393',
  'EPA (U.S. Environmental Protection Agency). 2009. "Guidance on the Development, Evaluation, and Application of Environmental Models". Council for Regulatory Environmental Modeling, Washington D.C., EPA/100/K-09/003.',
  'DEQ (Oregon Department of Environmental Quality). 2013. "Data validation criteria for water quality parameters measured in the field. DEQ04-LAB-0003-QAG Version5.0." http://www.oregon.gov/deq/FilterDocs/DataQualMatrix.pdf',
  'Bond, R.M, Stubblefields, A.P., Van Kirk, R.W. 2015. “Sensitivity of summer stream temperatures to climate variability and riparian reforestation strategies.” Journal of Hydrology: Regional Studies. 4(B): 267-279.',
  'Boyd, M., Kasper B. 2003. “Analytical Methods for Dynamic Open Channel Heat and Mass Transfer: Methodology for Heat Source Model Version 7.0.”',
  'Boyd, M.S. 1996. “Heat Source: Stream, River, and Open Channel Temperature Prediction.” Oregon State University: Corvallis.',
  'DEQ (Oregon Department of Environmental Quality). 1999. “Heat Source methodology review and comments.” Accessed at http://www.deq.state.or.us/wq/tmdls/heatsource.htm.',
  'Diabat, M., Haggerty, R., Wondzell, S.M., 2013. “Diurnal timing of warmer air under climate-change affects magnitude, timing and duration of stream temperature change.” Hydrological. Processes. 27(16): 2367–2.',
  'Holzapfel, G., Weihs, P., Rauch, H.P. 2013. Use of the Shade-a-lator 6.2 model to assess the shading potential of riparian purple willow (Salix purpurea) coppices on small to medium sized rivers. Ecological Engineering. 61(B): 697–705.',
  'IMST (Independent Multidisciplinary Science Team). 2004. “Oregon’s water temperature standard and its application: causes, consequences, and controversies associated with stream temperature.” Technical Report 2004-1 to the Oregon Plan for Salmon and Watersheds, Oregon Watershed Enhancement Board, Salem, OR.',
  'Justice, C., White, S.M., McCullough, D.A. Graves, D.S., Blanchard, M.R. 2017. “Can Stream and riparian restoration offset climate change impacts to salmon populations?” Journal of Environmental Management. 188: 212-227.',
  'Lawrence, D.J., Stewart-Koster, B., Olden, J.D., Ruesch, A.S., Torgersen, C.E., Lawler, J.J., Butcher, D.P., Crown, J.K. 2014. “The interactive effects of climate change, riparian management, and a nonnative predator on stream-rearing salmon.” Ecological Applications. 24(4): 895-912.',
  'Loheide S.P., Gorelick, S.M. 2006. Quantifying stream−aquifer interactions through the analysis of remotely sensed thermographic profiles and in situ temperature histories.” Environmental Science and Technology. 40(10): 3336-3341.',
  'Woltemade, C.J., and Hawkins, T.W. 2016. “Stream temperature impacts because of changes in air temperature, land cover, and stream discharge: Navarro River watershed, California, USA.” River Research Applications. 32(10): 2020-2031.',
  'Wondzell, S.M., Diabat, M. and Haggerty, R. 2019. “What matters most: Are future stream temperatures more sensitive to changing air temperatures, discharge, or riparian vegetation?” Journal of the American Water Resources Association. 55(1): 116-132.',
  'Gianfagna, C. J. 2015. “Watershed area ratio accurately predicts daily streamflow in nested catchments in the Catskills, New York.” Journal of Hydrology, 583-594.',
  'Risley, J. S. 2009. “Estimating flow-duration and low-flow frequency statistics for unregulated stream in Oregon.” Reston, VA: U.S. Geological Survey.',
  'Bencala, K.E. and Walters, R.A. 1983. “Simulation of solute transport in a mountain pool‐and‐riffle stream: A transient storage model.” Water Resources Research. 19(3), 718-724.',
  'Hart, D. R. 1995. “Parameter estimation and stochastic interpretation of the transient storage model for solute transport in streams.” Water Resources Research. 31(2), 323-328.',
  'Pelletier, G.J., Chapra, C., Taob, H. 2006. “QUAL2Kw – A framework for modeling water quality in streams and rivers using a genetic algorithm for calibration.” Environmental Modelling & Software. 21(3), 419-425.',
  'Sinokrot B.A. and Stefan H.G. 1993. “Stream Temperature Dynamics: Measurements and Modeling.” Water Resources Research. 29(7), 2299-2312.',
  'Ries, K.G., III, Newson J.K., Smith, M.J., Guthrie, J.D., Steeves, P.A., Haluska, T.L., Kolb, K.R., Thompson, R.F., Santoro, R.D., and Vraga, H.W.. 2017. “StreamStats, version 4: U.S. Geological Survey Fact 2017–3046, 4 p.” https://doi.org/10.3133/fs20173046. [Supersedes USGS Fact Sheet 2008–3067.]',
  'Lorenz, D.L. and Ziegeweid, J.R. 2016. “Methods to estimate historical daily streamflow for ungaged stream locations in Minnesota. No. 2015-5181.” US Geological Survey, 2016.',
  'Risley, J., Stonewall, A. and Haluska, T. 2008. “Estimating flow-duration and low-flow frequency statistics for unregulated streams in Oregon. No. FHWA-OR-RD-09-03”. Geological Survey (US), 2008.'))

qapp.ref <- rbind(tmdl.ref,tir.ref,mod.ref,other.ref) %>% 
  dplyr::arrange(reference)

for(r in unique(sort(qapp.ref$reference))) {
  
  cat(paste0(r,"    "))
  cat("\
  
      ")
  cat("\n")
  
}

```

\newpage
# Appendix A Continuous temperature data summary

```{r, echo=FALSE}

t53_2 <- data.sample.count %>%
  dplyr::filter(!`Station ID` == "TIR") %>% 
  dplyr::mutate(Station = StationDes) %>% 
  dplyr::select(Year, `Station ID`, Station, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec) %>% 
  dplyr::arrange(Year, `Station ID`)

if(NROW(t53_2)>0){
  
  t53_2_tbl <- knitr::kable(t53_2, format = "pandoc", padding = 2,
                            caption = tbls(name = "t53_2",
                                           caption = paste0("Summary of existing temperature data in the ", qapp_project_area,". Columns Jan – Dec indicate the number of daily maximum temperature results in each month.")))
  
}

```

`r t53_2_tbl`
