---
output: 
  word_document:
    reference_docx: T:/Temperature_TMDL_Revisions/model_QAPPs/R/data/Report_Template.docx
    keep_md: yes
    toc: yes
    fig_caption: yes
    fig_width: 12
    fig_height: 6
---

```{r setup_chap6x5, include=FALSE}

knitr::opts_chunk$set(results = "asis",
                      warning = FALSE,
                      error = FALSE,
                      message = FALSE,
                      autodep = TRUE)

options(kableExtra.auto_format = F)

# For testing: model_extent <- "Model 1: Lemolo Reservoir to Lemolo Powerhouse #1"

```

##### `r model_extent`

```{r, label=`t6x5j`, include=FALSE}

t6x5j <- section.model.input %>% 
  dplyr::filter(`Model Extent` %in%  model_extent) %>% 
  dplyr::filter(`Model Location Type` == "Calibration Site") %>%
  dplyr::mutate(`Data Source` = ifelse(`Station ID` == "TIR", strip_alpha(`Data Source`), `Data Source`),
                `Data Source` = ifelse(`Station ID` == "TIR", paste0(gsub(",.*$", "", `Data Source`)," (",stringi::stri_sub(`Data Source`,-4),")"), `Data Source`),
                `Data Source` = ifelse(is.na(`Data Source`),"",`Data Source`),
                `Data Source` = ifelse(is.na(`Interpolated Data`), `Data Source`, paste0("Derived data. ",`Data Source`)),
                Parameter = ifelse(`Station ID` == "TIR", paste0(Parameter," (TIR)"), Parameter),
                `Station ID` = ifelse(`Station ID` == "TIR",NA,`Station ID`),
                `Model Location Name (Station ID)` = ifelse(`Station ID` == "No Station ID or unknown" | is.na(`Station ID`),
                                                            `Model Location Name`,
                                                            paste0(`Model Location Name`, " (",`Station ID`,")")),
                `Model Location` = round(`Model Location`,2)) %>%
  dplyr::arrange(Parameter,desc(`Model Location`)) %>% 
  #dplyr::select(`Model Location Name (Station ID)`, `Model Location`, `Parameter`, `Data Source`) %>% 
  dplyr::rename(`Calibration Parameter` = `Parameter`)

t6x5j_col <- t6x5j %>% 
  dplyr::filter(!is.na(`Location Units`))

names(t6x5j)[names(t6x5j) == "Model Location"] <- if(NROW(t6x5j_col)>0){paste0("Model Location (",unique(t6x5j_col$`Location Units`),")")}else{paste0("Model Location")}

t6x5j <- t6x5j[,c(19,9,6,13)]

if(NROW(t6x5j)>0){
  
  t6x5j_tbl <- knitr::kable(t6x5j, format = "pandoc", padding = 2,
                     caption = tbls(name = paste0("t6x5j", model_extent),
                                    caption = paste0("Calibration sites and parameters used in the existing ", model_extent, " Heat Source Model.")))
  
}

```

`r if(NROW(t6x5j)>0){paste0("Model calibration was completed by DEQ and described in the ",paste0(unique(section.model.info$'TMDL Document')," (",strip_alpha(unique(section.model.info$'Abbreviated Reference')), "). Temperature, flow, and effective shade calibration sites are summarized in "),tbls(name = paste0("t6x5j", model_extent),display="cite")," to improve documentation of the TMDL approach. The current condition calibration may be updated to reflect spawning period conditions. Potential model calibration adjustments are described in Section 6.2 General model parameters.")}`

`r if(NROW(t6x5j)>0){t6x5j_tbl}`